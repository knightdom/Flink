# Flink学习笔记

## 系统架构

![image-20220909164739537](/Users/edgar/Documents/www/Flink/markdown-images/image-20220909164739537.png)

### 作业管理器(JobManager)

控制一个应用程序执行的主进程，是Flink集群中任务管理和调度的核心。

每个应用程序有且仅有一个JobManager正在运行。

#### Jobmaster

- JobMaster是JobManager中最核心的组件，负责处理**单独**的作业(Job)
- JobMaster工作流程
  1. 客户端接收需要执行的应用（例如，Jar包）
  2. 由客户端将应用分析，获得：Jar包、数据流图(dataflow graph)、作业图(JobGraph)，并提交给JobMaster
  3. JobMaster将JobGraph转换成一个物理层面的数据流图-执行图(ExecutionGraph)，它包含了所有可以并发执行的任务。
  4. JobMaster向资源管理器(ResourceManager)发出请求，申请执行任务的必要资源
  5. 获得足够的资源后，JobMaster就将ExecutionGraph分发到真正运行的TaskManager
  6. 在运行过程中，JobMaster会负责所有需要中央协调的操作，例如检查点(checkpoints)的协调

#### 资源管理器(ResourceManager)

- 负责资源的分配和管理
- 在Flink集群中只有一个
- “资源”，TaskManager中的任务槽(task slots)。任务槽就是集群中的资源调配单元，包括执行计算的一组CPU和内存资源。
- 每个任务(Task)都需要分配到一个slot上执行

#### 分发器(Dispatcher)

- 负责提供一个REST接口，用来提交应用，并负责为每个新提交的作业启动一个新的JobMaster组件
- 启动一个Web UI，用来展示监控信息
- 非必需

### 任务管理器(TaskManager)

Flink集群中的工作进程。通常一个集群中有多个TaskManager运行。

每个TaskManager包含了一定数量的插槽(slots)。**插槽的数量限制了TaskManager能够并行处理的任务数量**

- TaskManager启动后，会向资源管理器注册它的插槽。
- 当收到ResourceManager的指令后，TaskManager就会将一个或者多个slot提供给JobMaster调用。
- JobMaster就可以向插槽分配任务开始执行。

执行过程中，一个TaskManager可以跟其他运行同一应用程序的TaskManager交换数据。

## 作业提交流程

### 整体的流程

![image-20220909172142399](/Users/edgar/Documents/www/Flink/markdown-images/image-20220909172142399.png)

### Standalone会话模式作业提交流程

![image-20220909172533159](/Users/edgar/Documents/www/Flink/markdown-images/image-20220909172533159.png)

### YARN会话模式作业提交流程

![image-20220909172729167](/Users/edgar/Documents/www/Flink/markdown-images/image-20220909172729167.png)

提交任务后，由YARN启动一个TaskManager的容器

### YARN单作业模式作业提交流程

![image-20220909172947948](/Users/edgar/Documents/www/Flink/markdown-images/image-20220909172947948.png)

## 数据流(DataFlow)

应用在JobMaster中会被映射成dataflows，包含了以下三个内容：

- source
- transform
- sink

每个dataflow以一个或者多个sources开始，以一个或者多个sinks结束
